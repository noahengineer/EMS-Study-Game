<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover" />
  <title>Unity WebGL — Study Game (Fullscreen Loading)</title>
  <link rel="shortcut icon" href="TemplateData/favicon.ico">
  <style>
    :root{
      --bg-1:#0f172a; /* deep blue */
      --bg-2:#071233; /* darker */
      --accent:#5eead4; /* mint */
      --muted:#94a3b8;
      --glass: rgba(255,255,255,0.04);
      --bar-height:14px;
    }

    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
    body{background:linear-gradient(135deg,var(--bg-1),var(--bg-2));color: #e6eef8;display:flex;align-items:center;justify-content:center;overflow:hidden}

    /* Fullscreen app container */
    #app{
      position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:20px;padding:28px;box-sizing:border-box;
    }

    /* Canvas and stage */
    .stage{
      width:100%;max-width:1400px;height:calc(100vh - 140px);max-height:820px;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;border-radius:18px;box-shadow:0 10px 40px rgba(2,6,23,0.7);
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06));
      backdrop-filter: blur(6px);
    }

    canvas{width:100%;height:100%;display:block;object-fit:cover}

    /* Loading overlay */
    #loading-screen{
      position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:18px;padding:28px;box-sizing:border-box;z-index:40;transition:opacity .6s ease,transform .6s ease;}

    #brand{
      display:flex;align-items:center;gap:14px;
    }
    .logo{
      width:68px;height:68px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#60a5fa);display:flex;align-items:center;justify-content:center;box-shadow:0 8px 30px rgba(34,197,94,0.08);flex-shrink:0;
    }
    .logo svg{width:40px;height:40px;filter:drop-shadow(0 6px 18px rgba(2,6,23,0.45));}
    .brand-title{font-size:18px;font-weight:600;letter-spacing:0.2px}
    .brand-sub{font-size:12px;color:var(--muted);}

    /* progress */
    .progress-wrap{width:min(880px,92%);max-width:95%;}
    .progress-bg{height:var(--bar-height);background:linear-gradient(90deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));border-radius:999px;overflow:hidden;border:1px solid rgba(255,255,255,0.03);}
    .progress-fill{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),#60a5fa);box-shadow:0 6px 20px rgba(96,165,250,0.12);transition:width .2s linear;}
    .progress-meta{display:flex;justify-content:space-between;margin-top:8px;font-size:13px;color:var(--muted);}

    /* spinner */
    .spinner{width:28px;height:28px;border-radius:50%;border:4px solid rgba(255,255,255,0.08);border-top-color:var(--accent);animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    /* footer controls */
    .controls{display:flex;gap:12px;align-items:center;color:var(--muted);font-size:13px}
    .btn{background:var(--glass);padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);display:inline-flex;gap:8px;align-items:center;cursor:pointer}
    .btn:active{transform:translateY(1px)}

    /* small helpers */
    .tips{font-size:13px;color:var(--muted);opacity:0.95;max-width:880px;text-align:center}

    /* Hidden when loaded */
    .hidden{opacity:0;pointer-events:none;transform:translateY(10px)}

    /* Fullscreen button on corner */
    #fullscreen-corner{position:fixed;right:18px;bottom:18px;background:linear-gradient(180deg,rgba(255,255,255,0.02), rgba(0,0,0,0.04));padding:8px;border-radius:10px;z-index:60;border:1px solid rgba(255,255,255,0.03);cursor:pointer}

    /* mobile adjustments */
    @media (max-width:720px){
      .stage{height:calc(100vh - 100px);border-radius:0}
      .logo{width:56px;height:56px}
      .brand-title{font-size:16px}
      .tips{font-size:12px}
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="stage" id="unity-container">
      <canvas id="unity-canvas" tabindex="-1"></canvas>

      <div id="loading-screen" role="status" aria-live="polite">
        <div id="brand">
          <div class="logo" aria-hidden="true">
            <!-- simple SVG mark — replace with your logo if you want -->
            <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="6" y="6" width="52" height="52" rx="10" fill="white" opacity="0.08"/><path d="M18 44c6-8 10-12 18-12s14 4 18 12" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" opacity="0.98"/></svg>
          </div>
          <div style="text-align:left;">
            <div class="brand-title">Study Game</div>
            <div class="brand-sub">Loading — preparing the experience</div>
          </div>
        </div>

        <div class="progress-wrap" aria-hidden="false">
          <div class="progress-bg" aria-hidden="true">
            <div id="progress-fill" class="progress-fill"></div>
          </div>
          <div class="progress-meta"><div id="progress-text">Starting...</div><div id="percent-text">0%</div></div>
        </div>

        <div style="display:flex;gap:12px;align-items:center;">
          <div class="spinner" aria-hidden="true"></div>
          <div class="tips" id="tip">Tip: Press <strong>F</strong> to toggle fullscreen.</div>
        </div>

        <div class="controls">
          <div id="btn-fullscreen" class="btn" role="button" tabindex="0">Enter Fullscreen</div>
          <div id="btn-cancel" class="btn" role="button" tabindex="0">Cancel</div>
        </div>
      </div>

      <div id="unity-warning" style="position:absolute;left:18px;top:18px;z-index:80"></div>
    </div>

    <div id="fullscreen-corner" title="Toggle fullscreen (F)">⤢</div>
  </div>

  <script>
    // ------------------ Configuration ------------------
    const buildUrl = "Build"; // change if your build folder is named differently
    const loaderUrl = buildUrl + "/Builds.loader.js";

    const config = {
      dataUrl: buildUrl + "/Builds.data.br",
      frameworkUrl: buildUrl + "/Builds.framework.js.br",
      codeUrl: buildUrl + "/Builds.wasm.br",
      streamingAssetsUrl: "StreamingAssets",
      companyName: "DefaultCompany",
      productName: "Study Game",
      productVersion: "0.1.0",
      showBanner: unityShowBanner
    };

    // ------------------ DOM refs ------------------
    const canvas = document.getElementById('unity-canvas');
    const loadingScreen = document.getElementById('loading-screen');
    const progressFill = document.getElementById('progress-fill');
    const percentText = document.getElementById('percent-text');
    const progressText = document.getElementById('progress-text');
    const tipEl = document.getElementById('tip');
    const btnFull = document.getElementById('btn-fullscreen');
    const btnCancel = document.getElementById('btn-cancel');
    const fsCorner = document.getElementById('fullscreen-corner');

    let unityInstance = null;
    let cancelled = false;

    // helpful tips to show while loading
    const tips = [
      "Tip: Press F to toggle fullscreen.",
      "Tip: Use headphones for a better experience.",
      "Tip: You can right-click and 'Save as' to download later (depends on browser).",
      "Tip: The game uses browser storage for saves.",
    ];
    let tipIndex = 0;
    function rotateTips(){
      tipIndex = (tipIndex + 1) % tips.length;
      tipEl.innerHTML = tips[tipIndex];
    }
    setInterval(rotateTips, 5000);

    // ------------------ Banner (copied+improved) ------------------
    function unityShowBanner(msg, type) {
      const warningBanner = document.getElementById("unity-warning");
      const div = document.createElement('div');
      div.innerHTML = msg;
      if (type === 'error') {
        div.style = 'background: #8b1e1e; color: white; padding:10px; border-radius:6px; margin-bottom:6px;';
        warningBanner.prepend(div);
      } else {
        div.style = 'background: rgba(255,255,255,0.06); color: var(--muted); padding:8px; border-radius:6px; margin-bottom:6px;';
        warningBanner.appendChild(div);
        setTimeout(()=>{ try{ warningBanner.removeChild(div);}catch(e){} }, 5000);
      }
    }

    // ------------------ Load Unity ------------------
    document.getElementById('btn-fullscreen').addEventListener('click', () => toggleFullscreen(true));
    fsCorner.addEventListener('click', () => toggleFullscreen(true));
    document.getElementById('btn-cancel').addEventListener('click', () => {
      cancelled = true;
      progressText.innerText = 'Cancelled';
      loadingScreen.classList.add('hidden');
    });

    window.addEventListener('keydown', (e) => {
      if (e.key === 'f' || e.key === 'F') toggleFullscreen();
    });

    function toggleFullscreen(forceUnity=false){
      if (unityInstance && !forceUnity){
        try{ unityInstance.SetFullscreen(1); return;}catch(e){}
      }
      const el = document.documentElement;
      if (!document.fullscreenElement) {
        el.requestFullscreen?.();
      } else {
        document.exitFullscreen?.();
      }
    }

    // Ensure canvas fills when fullscreen/resized (keeps aspect ratio by CSS)
    function resizeCanvasToDisplaySize(){
      // We allow Unity to use devicePixelRatio by default; this keeps it crisp on HiDPI
      canvas.style.width = '100%';
      canvas.style.height = '100%';
    }
    window.addEventListener('resize', resizeCanvasToDisplaySize);

    // append loader script and start creating instance
    const script = document.createElement('script');
    script.src = loaderUrl;
    script.onload = () => {
      createUnityInstance(canvas, config, (progress) => {
        if (cancelled) return;
        const pct = Math.min(1, Math.max(0, progress || 0));
        progressFill.style.width = (pct * 100).toFixed(1) + '%';
        percentText.innerText = Math.round(pct * 100) + '%';
        if (pct < 0.01) progressText.innerText = 'Initializing...';
        else if (pct < 0.3) progressText.innerText = 'Downloading assets...';
        else if (pct < 0.7) progressText.innerText = 'Preparing scene...';
        else progressText.innerText = 'Finishing up...';
      }).then((instance) => {
        unityInstance = instance;
        // hide overlay smoothly
        loadingScreen.classList.add('hidden');

        // When Unity enters fullscreen via API, make sure canvas is resized
        document.addEventListener('fullscreenchange', resizeCanvasToDisplaySize);

        // attach a convenience fullscreen toggle that prefers Unity API
        fsCorner.addEventListener('click', ()=>{ try{ unityInstance.SetFullscreen(1);}catch(e){ toggleFullscreen(true);} });

      }).catch((e) => {
        console.error(e);
        unityShowBanner('Failed to load game: ' + String(e), 'error');
      });
    };
    document.body.appendChild(script);

    // set initial sizes and tip text
    resizeCanvasToDisplaySize();
    tipEl.innerHTML = tips[0];

  </script>
</body>
</html>
